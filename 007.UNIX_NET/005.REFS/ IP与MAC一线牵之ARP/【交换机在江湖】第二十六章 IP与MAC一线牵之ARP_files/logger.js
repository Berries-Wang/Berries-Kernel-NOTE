!function(){"use strict";function e(e){return"function"==typeof e}function t(e,r){return e&&"object"==typeof e?(e instanceof Error&&(e={message:e.message,stack:e.stack}),(r=null!=r?r:1)>2?"...":function(e){for(var t={},r=e;r&&r!==Object.prototype;r=Object.getPrototypeOf(r))for(var n=0,o=Object.getOwnPropertyNames(r);n<o.length;n++){var i=o[n];t[i]=i}return Object.keys(t).filter((function(e){return"constructor"!==e&&!e.startsWith("_")})).sort()}(e).filter((function(t){return r=e[t],Object(r)!==r||"object"==typeof r||void 0;var r})).map((function(n){return""+Array(2*r).join(" ")+n+": "+t(e[n],r+1)})).join("\n")):e+""}!function(e){var t="currentScript",r=e.getElementsByTagName("script");t in e||Object.defineProperty(e,t,{get:function(){try{throw new Error}catch(n){var e,t=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(n.stack)||[!1])[1];for(e in r)if(r[e].src==t||"interactive"==r[e].readyState)return r[e];return null}}})}(document);var r,n,o=(r=window,!(n=!!document.documentMode)&&r.StyleMedia?"edge":r.chrome?"chrome":n?"ie":"undefined"!=typeof InstallTrigger?"firefox":"others");function i(e,r){if("file:"!==e.location.protocol){!function(e,r){if(e.fetch){var n=e.fetch;e.fetch=function(){var e=arguments;return n.apply(this,e).then((function(n){return n.ok||r.sendError({title:e[0],desc:t(n),category:"network",level:"error"}),n})).catch((function(n){throw r.sendError({title:e[0],desc:t({message:n.message,stack:n.stack}),category:"network",level:"error"}),n}))}}}(e,r);var n=e.XMLHttpRequest;if(n){var o=n.prototype.send,i=function(e){e&&e.currentTarget&&200!==e.currentTarget.status&&r.sendError({title:"request error: "+e.target.responseURL,desc:t({response:e.target.response,responseURL:e.target.responseURL,status:e.target.status,statusText:e.target.statusText}),category:"network",level:"error"})};n.prototype.send=function(){var e=this.addEventListener.bind(this);if(e)e("error",i),e("load",i),e("abort",i);else{var t=this.onreadystatechange;this.onreadystatechange=function(e){4===this.readyState&&i(e),t&&t.apply(this,arguments)}}return o.apply(this,arguments)}}}}var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var c,s=(function(e){
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var t=t||function(e){if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,r=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,i=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),c=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},s=function(e){setTimeout((function(){"string"==typeof e?r().revokeObjectURL(e):e.remove()}),4e4)},u=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},f=function(t,f,l){l||(t=u(t));var d,p=this,v="application/octet-stream"===t.type,h=function(){!function(e,t,r){for(var n=(t=[].concat(t)).length;n--;){var o=e["on"+t[n]];if("function"==typeof o)try{o.call(e,r||e)}catch(e){c(e)}}}(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,o)return d=r().createObjectURL(t),void setTimeout((function(){var e,t;n.href=d,n.download=f,e=n,t=new MouseEvent("click"),e.dispatchEvent(t),h(),s(d),p.readyState=p.DONE}));!function(){if((a||v&&i)&&e.FileReader){var n=new FileReader;return n.onloadend=function(){var t=a?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,p.readyState=p.DONE,h()},n.readAsDataURL(t),void(p.readyState=p.INIT)}d||(d=r().createObjectURL(t)),v?e.location.href=d:e.open(d,"_blank")||(e.location.href=d),p.readyState=p.DONE,h(),s(d)}()},l=f.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,r){return t=t||e.name||"download",r||(e=u(e)),navigator.msSaveOrOpenBlob(e,t)}:(l.abort=function(){},l.readyState=l.INIT=0,l.WRITING=1,l.DONE=2,l.error=l.onwritestart=l.onprogress=l.onwrite=l.onabort=l.onerror=l.onwriteend=null,function(e,t,r){return new f(e,t||e.name||"download",r)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||a.content);e.exports&&(e.exports.saveAs=t)}(c={exports:{}},c.exports),c.exports);var u=setTimeout;function f(e){return Boolean(e&&void 0!==e.length)}function l(){}function d(e){if(!(this instanceof d))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],m(e,this)}function p(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,d._immediateFn((function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(e){return void h(t.promise,e)}v(t.promise,n)}else(1===e._state?v:h)(t.promise,e._value)}))):e._deferreds.push(t)}function v(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof d)return e._state=3,e._value=t,void y(e);if("function"==typeof r)return void m(function(e,t){return function(){e.apply(t,arguments)}}(r,t),e)}e._state=1,e._value=t,y(e)}catch(t){h(e,t)}}function h(e,t){e._state=2,e._value=t,y(e)}function y(e){2===e._state&&0===e._deferreds.length&&d._immediateFn((function(){e._handled||d._unhandledRejectionFn(e._value)}));for(var t=0,r=e._deferreds.length;t<r;t++)p(e,e._deferreds[t]);e._deferreds=null}function g(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function m(e,t){var r=!1;try{e((function(e){r||(r=!0,v(t,e))}),(function(e){r||(r=!0,h(t,e))}))}catch(e){if(r)return;r=!0,h(t,e)}}d.prototype.catch=function(e){return this.then(null,e)},d.prototype.then=function(e,t){var r=new this.constructor(l);return p(this,new g(e,t,r)),r},d.prototype.finally=function(e){var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){return t.reject(r)}))}))},d.all=function(e){return new d((function(t,r){if(!f(e))return r(new TypeError("Promise.all accepts an array"));var n=Array.prototype.slice.call(e);if(0===n.length)return t([]);var o=n.length;function i(e,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,(function(t){i(e,t)}),r)}n[e]=a,0==--o&&t(n)}catch(e){r(e)}}for(var a=0;a<n.length;a++)i(a,n[a])}))},d.resolve=function(e){return e&&"object"==typeof e&&e.constructor===d?e:new d((function(t){t(e)}))},d.reject=function(e){return new d((function(t,r){r(e)}))},d.race=function(e){return new d((function(t,r){if(!f(e))return r(new TypeError("Promise.race accepts an array"));for(var n=0,o=e.length;n<o;n++)d.resolve(e[n]).then(t,r)}))},d._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){u(e,0)},d._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var w,E="errorlog";function j(e){return w=new d((function(t,r){var n=indexedDB.open(e);n.onupgradeneeded=function(e){e.target.result.createObjectStore(E,{autoIncrement:!0}).createIndex("by-time","time",{unique:!1})},n.onsuccess=function(e){t(n.result)},n.onerror=function(e){r(e)}}))}function b(e){w.then((function(t){e.time=new Date,t.transaction([E],"readwrite").objectStore(E).add(e)}))}function _(e){e||(e="1d"),T(e).then((function(e){console.log(O(e))}))}function S(e){e||(e="7d"),T(e).then((function(e){var t=new Blob([O(e)],{type:"text/plain;charset=utf-8"});s.saveAs(t,"errorlog.log")}))}function O(e){var t=e.errorlog;return t?t.map((function(e){var t,r=e.title+(e.desc?", "+e.desc:"");return"["+(null===(t=e.time)||void 0===t?void 0:t.toLocaleString("zh-CN",{hour12:!1}))+"]["+e.level+"]["+e.category+"]"+r})).join("\n"):"(empty)"}function T(e){return new d((function(t,r){var n=function(e){var t=new Date(-864e13);if(!e)return t;var r=(e=e.toLowerCase()).substr(e.length-1);"mhd".indexOf(r)>=0?e=e.substr(0,e.length-1):r="";if(!/^[0-9]+$/.test(e))return console.warn("invalid duration format"),t;var n=new Date,o=parseInt(e);r&&"m"!==r?"h"===r?n.setHours(n.getHours()-o):"d"===r&&n.setDate(n.getDate()-o):n.setMinutes(n.getMinutes()-o);return n}(e);w.then((function(e){var o={};if(0===e.objectStoreNames.length)t(o);else try{var i=e.transaction([E],"readonly").objectStore(E).index("by-time"),a=IDBKeyRange.lowerBound(n),c=[],s=i.openCursor(a);s.onsuccess=function(e){var r=e.target.result;r?(c.push(r.value),r.continue()):(o.errorlog=c,t(o))},s.onerror=function(e){r(e)}}catch(e){r(e)}}))}))}var k,L=Object.freeze({__proto__:null,init:j,record:b,print:_,download:S}),x="__linkjs_environment",R=function(e){for(var t,r=/[?&]([^=#]+)=([^&#]*)/g,n={};t=r.exec(e);)n[t[1]]=t[2];return n}((k=document.currentScript)&&(k.src||k._src)).name||"";if(!R)throw"name for logger is not specify";j(R),function(r){var n,a=(c={jsError:!0,resourceError:!0,networkError:!0,consoleError:!0,scriptError:!0,filters:[],levels:["info","warning","error"],category:["js","resource","network"],sendError:function(e){}},s=r,s?(function(e,t){var r,n,o,i;if(void 0===e.length)for(r in e)o=e,i=r,Object.prototype.hasOwnProperty.call(o,i)&&t.call(null,r,e[r]);else if(n=e.length)for(r=0;r<n;r++)t.call(null,r,e[r])}(s,(function(e,t){c[e]=t})),c):c);var c,s;a.scriptError||null===(n=a.filters)||void 0===n||n.push((function(){return/^Script error\.?$/.test(arguments[0])}));var u=a.sendError;a.sendError=function(t){var r;try{var n=this;if(null===(r=a.filters)||void 0===r?void 0:r.some((function(t){return e(t)&&t.apply(n,arguments)})))return;u(t)}catch(e){u({time:new Date,title:"linkjs-logger",desc:e,category:"js"})}};var f=window,l=f.addEventListener;a.jsError&&function(r,n){var o=r.onerror;r.onerror=function(i,a,c,s,u){var f=(null==u?void 0:u.stack)?u.stack:a+":"+c+":"+s,l={title:t(i),category:"js",level:"error",desc:f};n.sendError(l),o&&e(o)&&o.apply(r,arguments)}}(f,a);a.jsError&&function(e,t){e.addEventListener("unhandledrejection",(function(e){if(e){var r=e.reason;t.sendError({title:"unhandledrejection",desc:r,category:"js",level:"error"})}}),!0)}(f,a);a.resourceError&&l&&function(e,t){e.addEventListener("error",(function(e){if(e&&e.target){var r=e.target||e.srcElement;if(!(r instanceof HTMLScriptElement||r instanceof HTMLLinkElement||r instanceof HTMLImageElement))return;var n=r.src||r.href;t.sendError({title:r.nodeName,desc:n,category:"resource",level:"error"})}}),!0)}(f,a);a.networkError&&i(f,a);a.consoleError&&function(e,r){if(e.console&&e.console.error){var n=e.console.error;e.console.error=function(){var i=[].map.call(arguments,(function(e){return e})),a=function(e){return e.startsWith("\n")?e:"\n"+e},c=function(e){if(!e)return"";var t=e.split("\n");return"chrome"===o||"edge"===o||"ie"===o?(t.splice(0,2),t[0]=a(t[0])):"firefox"===o&&(t.splice(0,1),t.forEach((function(e,r){return t[r]=0===r?a(e):"  "+e}))),t.join("\n")};r.sendError({title:i.map((function(e){return t(e)})).join(" "),desc:c(Error().stack),category:"js",level:"error"}),n&&n.apply(e.console,arguments)}}}(f,a);f[x]=f[x]||{},f[x].logger={print:_.bind(L),download:S.bind(L),trace:function(){var e=[].map.call(arguments,(function(e){return e}));a.sendError({level:"trace",title:e.map((function(e){return t(e)})).join(" "),category:"js"})}}}({sendError:function(e){b(e)}})}();
